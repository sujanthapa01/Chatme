import f from"path";import m from"fs";import x from"dotenv";import E from"dotenv-expand";function u(i,e,n=!1){for(let p of e){let t=f.join(i,p);if(m.existsSync(t)&&m.statSync(t).isFile())return n?t:m.readFileSync(t,"utf-8")}let s=f.dirname(i);if(s!==i)return u(s,e,n)}function v(i){let{mode:e,envDir:n,prefix:s,ignoreProcessEnv:p}=i;if(e==="local")throw new Error('"local" cannot be used as a mode name because it conflicts with the .local postfix for .env files.');let t={},a=[`.env.${e}.local`,`.env.${e}`,".env.local",".env"];for(let o in process.env)o.startsWith(s)&&t[o]===void 0&&(t[o]=process.env[o]);for(let o of a){let l=u(n,[o],!0);if(l){let c=x.parse(m.readFileSync(l),{debug:!!process.env.DEBUG||void 0});E({parsed:c,ignoreProcessEnv:p});for(let[r,d]of Object.entries(c))r.startsWith(s)&&t[r]===void 0?t[r]=d:r==="NODE_ENV"&&(process.env.VITE_USER_NODE_ENV=d)}}return t}function g(i){let e={};return Object.keys(process.env).map(n=>{String(n).includes(i)&&(e[n]=process.env[n]||"")}),e}var b="vite-plugin-env-compatible";import y from"path";function j(i={}){let e={mountedPath:"process.env",...i};return{name:b,enforce:"pre",config(n,{mode:s}){let p=n.root||process.cwd(),t=n.envDir||"./";y.isAbsolute(t||"")||(t=y.join(p,t));let a=typeof e.prefix>"u"?"VUE_APP_":e.prefix,o=v({mode:s,envDir:t,prefix:a,ignoreProcessEnv:e.ignoreProcessEnv??!1}),l=g(a),c={};e.mountedPath?.startsWith("process.env")&&(c["process.env.VITE"]=JSON.stringify(!0)),Object.keys({...o,...l}).map(r=>{let d=o[r];c[`${e.mountedPath}.${r}`]=JSON.stringify(d)}),n.define={...n.define||{},...c}}}}export{j as default};
